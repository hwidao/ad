<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Firebase 게시판</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    textarea {
      width: 100%;
      height: 100px;
      font-size: 16px;
    }

    input[type="file"] {
      margin-top: 10px;
    }

    button {
      margin-top: 10px;
      padding: 8px 16px;
      cursor: pointer;
    }

    .post {
      border: 1px solid #ccc;
      margin-top: 20px;
      padding: 10px;
      position: relative;
    }

    .post img {
      max-width: 200px;
      display: block;
      margin-top: 10px;
    }

    .post-actions {
      margin-top: 10px;
    }

    .post-actions button {
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <h2>📌 Firebase 게시판</h2>

  <textarea id="message" placeholder="내용을 입력하세요"></textarea><br>
  <input type="file" id="imageInput" accept="image/*"><br>
  <button onclick="submitPost()">등록</button>

  <hr>

  <div id="postsContainer"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>

  <script>
    // ✅ Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyBCEHZSZe2wpeHc6WctUcjyUuNS8p3fxqI",
      authDomain: "hwidao-5f9de.firebaseapp.com",
      databaseURL: "https://hwidao-5f9de-default-rtdb.firebaseio.com",
      projectId: "hwidao-5f9de",
      storageBucket: "hwidao-5f9de.appspot.com",
      messagingSenderId: "372324706194",
      appId: "1:372324706194:web:240e639ea9df95a887c34b"
    };

    // ✅ Firebase 초기화
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let editKey = null;

    function submitPost() {
      const message = document.getElementById('message').value.trim();
      const imageInput = document.getElementById('imageInput');
      const file = imageInput.files[0];

      if (!message && !file) {
        alert("내용 또는 이미지를 입력하세요.");
        return;
      }

      const reader = new FileReader();

      reader.onload = function () {
        const postData = {
          message,
          image: file ? reader.result : null,
          date: new Date().toLocaleString()
        };

        if (editKey) {
          // 수정
          database.ref('posts/' + editKey).set(postData, () => {
            editKey = null;
            clearForm();
            renderPosts();
          });
        } else {
          // 새 글
          const newPostRef = database.ref('posts').push();
          newPostRef.set(postData, () => {
            clearForm();
            renderPosts();
          });
        }
      };

      if (file) {
        reader.readAsDataURL(file);
      } else {
        reader.onload();
      }
    }

    function clearForm() {
      document.getElementById('message').value = '';
      document.getElementById('imageInput').value = '';
    }

    function renderPosts() {
      const container = document.getElementById('postsContainer');
      container.innerHTML = '';

      database.ref('posts').once('value', snapshot => {
        const posts = [];
        snapshot.forEach(child => {
          posts.unshift({
            key: child.key,
            ...child.val()
          });
        });

        posts.forEach(post => {
          const div = document.createElement('div');
          div.className = 'post';

          div.innerHTML = `
            <p><strong>작성일:</strong> ${post.date}</p>
            <p>${post.message}</p>
            ${post.image ? `<img src="${post.image}" alt="첨부 이미지">` : ''}
            <div class="post-actions">
              <button onclick="editPost('${post.key}')">수정</button>
              <button onclick="deletePost('${post.key}')">삭제</button>
            </div>
          `;

          container.appendChild(div);
        });
      });
    }

    function deletePost(key) {
      if (confirm("정말 삭제하시겠습니까?")) {
        database.ref('posts/' + key).remove(() => {
          renderPosts();
        });
      }
    }

    function editPost(key) {
      database.ref('posts/' + key).once('value', snapshot => {
        const post = snapshot.val();
        document.getElementById('message').value = post.message;
        document.getElementById('imageInput').value = '';
        editKey = key;
      });
    }

    renderPosts();

    function submitPost() {
  const message = document.getElementById('message').value.trim();
  const imageInput = document.getElementById('imageInput');
  const file = imageInput.files[0];

  if (!message && !file) {
    alert("내용 또는 이미지를 입력하세요.");
    return;
  }

  const reader = new FileReader();

  reader.onload = function () {
    const postData = {
      message,
      image: file ? reader.result : null,
      date: new Date().toLocaleString()
    };

    if (editKey) {
      // 수정
      database.ref('posts/' + editKey).set(postData)
        .then(() => {
          console.log("수정 성공!");
          editKey = null;
          clearForm();
          renderPosts();
        })
        .catch(error => {
          console.error("수정 실패:", error);
        });
    } else {
      // 새 글 등록
      const newPostRef = database.ref('posts').push();
      newPostRef.set(postData)
        .then(() => {
          console.log("저장 성공!");
          clearForm();
          renderPosts();
        })
        .catch(error => {
          console.error("저장 실패:", error);
        });
    }
  };

  if (file) {
    reader.readAsDataURL(file);
  } else {
    reader.onload();
  }
}

  </script>
</body>
</html>
